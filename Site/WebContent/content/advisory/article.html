<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta name="author" content="Mardy Jonathan"/>
<title></title>
</head>
<body>
	<div class="breadcrumb-wrapper">
			<div class="breadcrumb">
				<div class="container">
					<ul>
					<li><a th:href="@{/}">Home</a></li>
					<li><a href="#">Advisory</a></li>
					</ul>
				</div>
			</div>
		</div>
		<div class="advisory_section">
			<div class="advisory_banner">
				<div class="parallax-window" data-parallax="scroll" th:attr="data-image-src=@{/images/Business-Research-Essay.jpg}" ></div>
				<div class="info_banner_search">
					<h1 class="find_advisor_title">Find Best Article</h1>
					<div class="part_div">
						<select class="select_tema">
							<option value="">Select Category</option>
							<option th:each="category, i : ${categories}" th:text="${category.name}">Make a Concept House</option>
						</select>
					</div>
					<div class="part_div">
						<select class="select_tema">
							<option value="">Select Advisor</option>
							<option th:each="advisor, i : ${advisors}" th:value="${advisor.party.pkParty}" th:text="${advisor.party.name}">George Martin</option>
						</select>
					</div>
					<div class="part_div">
						<input type="text" class="find_name" placeholder="Name"/>
					</div>
					<div class="part_div">
						<button type="button" class="btn btn-danger btn_find">FIND NOW</button>
					</div>
				</div>
			</div>
			
			<!-- Start advisory article -->
			<div class="advisory_article">
				<div class="container">
					<div class="article_container row">
						<div id="template" class="col-md-3" th:each="article, i : ${articles.result}"> 
							<div class="box_article_wrapper">
								<div class="article_box_image"><img th:src="${article.basicPictureURL}" /></div> 
								<div class="article_box_content">
									<input type="hidden" name="pkArticle" th:value="${article.pkArticle}" class="id_article" />
									<h2 class="title_article" th:text="${article.name}">Concept House</h2>
									<div class="subtitle_article"><label th:text="${article.category.name}">Make a Concept House</label></div>
									<div class="created_advisor"><label>By: &nbsp;</label><label th:text="${article.createdBy}" class="created_by">John Doe</label></div>
									<div class="date_advisor"><label>Created: &nbsp;</label><label th:text="${#dates.format(article.creationTime, 'dd MMMM yyyy')}" class="article_date">30 Januari 2017</label></div>
									<p class="article_content" th:text="${#strings.substring(article.content,0,200) + ' ...'}" th:if="${#strings.length(article.content) &gt; 200}">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean sed dictum lectus. Donec lacus ante, tristique non ...</p>
									<p class="article_content" th:text="${article.content}" th:if="${#strings.length(article.content) &lt; 200}">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean sed dictum lectus. Donec lacus ante, tristique non ...</p>
									<div><a href="#" style="font-size: 12px;" class="read_more">Read More</a></div>
								</div>
							</div>
						</div>
						<div class="row load_pagination" style="display: none;">
							<div class="col-md-12">
								<div class="col-md-4"></div>
								<div class="col-md-4"> <img th:src="@{/images/gif/loading_linear.gif}" style="margin-left: 50px;"/> </div>
								<div class="col-md-4"></div>
							</div>
						</div>
					</div>
					<div class="bouton bouton-red"><a href="#" class="load_more"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> Load More</a></div>
					<div style="margin-bottom: 20px;"></div>
				</div>
			</div>
			
			
			<!-- Closing advisory -->
			<div style="background-color: #f4f4f4;">
				<div class="advisory_consult" style="padding-top: 40px;">
					<h1>Have A Question?</h1>
					<p class="small-text">All your confusing and problem will be answered all by the experts.</p>
					<button type="button" class="btn btn-primary consult_btn">CONSULT NOW <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span></button>
				</div>
			</div>
		</div><!--end post section-->
		
		<script type="text/javascript" th:inline="javascript">
		/*<![CDATA[*/
		function showPaging(maxRecord, currentRecord){
			if(maxRecord <= currentRecord || currentRecord == 0){
				$('.pagination_part').hide();
			}else{
				$('.pagination_part').show();
			}
		}
		
		function processData(datas, load){
			var load_content = '';
			for(var i=0;i<datas.length;i++){
				var cloning = $('.template_part .data_result').eq(0).clone();
				cloning.find('.id_article').val(datas[i].pkArticle);
				cloning.find('.article_box_image').attr('src',datas[i].basicPictureURL);
				cloning.find('.title_article').html(datas[i].name);
				cloning.find('.subtitle_article label').html(datas[i].category.name);
				cloning.find('.created_by').html(datas[i].createdBy);
				cloning.find('.article_date').html(moment(datas[i].creationTime).format('DD MMMM YYYY'));
				if(datas[i].content){
					if(datas[i].content.length>200){
						cloning.find('.article_content').html(datas[i].content.substring(0,200) + ' ...');
					}else{
						cloning.find('.article_content').html(datas[i].content);
					}
				}
				cloning.wrap('<div></div>');
				if(!load){
					$('.list_data').append(cloning.parent().html());
				}else{
					load_content = load_content + cloning.parent().html();
				}
			}
			
			if(load){
				$('.list_data').html(load_content);
			}
		}           
		           
		$(function(){      
			var maxRecord = /*[[${articles.maxRecord}]]*/;
			var currentRecord = /*[[${articles.currentRecord}]]*/;
			
			showPaging(maxRecord, currentRecord);
			
			$('.load_more').unbind('click').click(function(e){
				e.preventDefault();
				var sURL = /*[[@{/page/advisory/sub/article/load}]]*/
				var param = $('.param').val();
				var nextStartNo = parseInt($('.startNo').val()) + parseInt($('.offset').val());
				var offset = $('.offset').val();
				$.ajax({
		            type: 'GET',
		            url: sURL,
		            data: {filter : param, startNo : nextStartNo, offset : offset},
		            dataType: 'json',
		            success: function (data) {
		            	$('.load_pagination').hide();
		            	$('.mrdy_btn').disableBtn({enabled:true});
		            	processData(data.articles.result, false);		
		            	var newMaxRecord = data.articles.maxRecord;
		            	var newCurrentRecord = data.articles.currentRecord;
		            	showPaging(newMaxRecord, newCurrentRecord);
		            },
		            beforeSend: function($jqXHR, $textStatus){
						$('.load_pagination').show();
						$('.mrdy_btn').disableBtn({enabled:false});
					},
					error: function ($jqXHR, $textStatus, $errorThrown) {
						$('.load_pagination').hide();
						$('.mrdy_btn').disableBtn({enabled:true});
					},
					complete: function($jqXHR, $textStatus){
						$('.load_pagination').hide();
						$('.mrdy_btn').disableBtn({enabled:true});
					}
		        });				
			});
			
			$('.consult_btn').unbind('click').click(function(){
				var url = /*[[@{/page/advisory/sub/consulting}]]*/
				window.location.href = url;
			});
			
			$('.title_article, .read_more').unbind('click').click(function(e){
				e.preventDefault();
				var val = $(this).parent('.article_box_content').find('.id_article').val();
				var url = /*[[@{/page/advisory/sub/article/detail/}]]*/
				url += val;
				window.location.href = url;
			});
		});
		
		/*]]>*/
		</script>
</body>
</html>