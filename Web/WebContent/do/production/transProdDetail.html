<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:ifs="http://padiku.id">
<head>
<meta charset="ISO-8859-1"/>
<title>TransProd</title>
<style>
.ui-datepicker {
	z-index : 10;
}
</style>
</head>
<body>
<div id="padiku-wizard">
	<div class="pageheader">
		<div class="row col-md-8">
			<h4><i class="fa fa-tachometer"></i> Pengolahan / Tambah Pengolahan<span></span></h4>
		</div>
		<!-- Wizard Section -->
		<div class="wizard-tab-container row-fluid col-md-8">
	    	<ul class="wizard-steps">
	        	<li data-target="step1" class="active">
					<span class="step">1</span>
					<span class="title">Informasi Pengolahan</span>
	            </li>
	            <li data-target="step2">
	             	<span class="step">2</span>
	             	<span class="title">Detail Pengolahan</span>
	            </li>
	            <li data-target="step3">
	             	<span class="step">3</span>
	             	<span class="title">Mesin Yang Digunakan</span>
	            </li>
	            <li data-target="step4">
	             	<span class="step">4</span>
	                <span class="title">Biaya-biaya</span>
				</li>
				<li data-target="step5">
	             	<span class="step">5</span>
	                <span class="title">Hasil</span>
				</li>
			</ul>
		</div>
	</div>
	<div  class="row col-md-8">
		<section class="tile color transparent-black">
			<div class="tile-body color step-content position-relative">
				<form action="#" id="transProd-detail-form" class="form-horizontal" method="POST" novalidate="novalidate" th:object="${detail}">
					<div class="stockTypeStyle">
						<div class="form-group">
							<div class="col-md-12">
								<div id="errorFragmentList3">
									<th:block th:if="${message}">
										<div class='alert alert-success'>
											<a href='#' class='close' data-dismiss='alert' aria-label='close' title='close'>&#10006;</a>			
											<label th:text="${message}"></label>
										</div>
									</th:block>
								</div>
							</div>									
						&nbsp;
						</div>
						<input id="transProd-detail-maintenancePk" type="hidden" th:field="*{pkTransProd}"/>
						<input id="transProd-detail-status" type="hidden" th:field="*{status}"/>
						<!-- STEP #1 -->
						<div class="active tab-pane" id="step1">
							<div class="form-group">
                              	<label class="col-sm-3 control-label">ID. Pengolahan</label>
                              	<div class="col-sm-9">
                                	<label th:if="*{prodNo == null}" th:text="'Generated By System'"></label>
                              		<label th:if="*{prodNo != null}">
                              			<input type="text" class="form-control" th:field="*{prodNo}" readonly="readonly"/>
                              		</label>
                              	</div>
                           	</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">Pengolahan Oleh</label>
                             	<div class="col-sm-9 form-input-container">
									<div class="btn-group" data-toggle="buttons">
							   			<label class="btn btn-primary active transIn-radio-type-button">
							   				<input type="radio" class="transProd-actor-prod"  th:field="*{actorProd.code}" th:value="${actorMandiri}" checked="checked"/> Mandiri
							   			</label>
										<label class="btn btn-primary transIn-radio-type-button">
											<input type="radio" class="transProd-actor-prod"  th:field="*{actorProd.code}" th:value="${actorThirdParty}"/> Pihak Ketiga
										</label>
									</div>
                             	</div>
                           	</div>
                           	<div class="form-group" id="produsen-content" style="display:none">
                              	<label class="col-sm-3 control-label">Nama Produsen</label>
                              	<div class="col-sm-9">
                                	<select class="transProd-produsen-select chosen-select chosen-transparent form-control" th:field="*{thirdParty.pkParty}">
                                    	<option th:each="opt : ${optionsProdusen}" th:value="${opt.pkParty}" th:text="${opt.name}"></option>
                                 	</select>
                              	</div>
                           	</div>
                           	<div class="form-group">
                              	<label class="col-sm-3 control-label">Tanggal Pengolahan</label>
                              	<div class="col-sm-9">
                                	<input type='text' class="datepicker input-date form-control" th:field="*{prodDateFrom}"/>
                              	</div>
                           	</div>
                     	</div>
                     	<!-- END STEP #1 -->
                     	
                     	<!-- STEP #2 -->
						<div class="tab-pane" id="step2">
							<div class="form-group">
								<label class="col-sm-3 control-label">Sumber Pengolahan</label>
                             	<div class="col-sm-9 form-input-container">
									<div class="btn-group" data-toggle="buttons">
							   			<label class="btn btn-primary active transProd-source-type-button">
							   				<input type="radio" class="transProd-source-type" th:field="*{transInSourceType}" th:value="${inSourceTypeBuying}" checked="checked"/> Pembelian
							   			</label>
										<label class="btn btn-primary transProd-source-type-button">
											<input type="radio" class="transProd-source-type" th:field="*{transInSourceType}" th:value="${inSourceTypeMaklon}"/> Maklon
										</label>
									</div>
                             	</div>
                           	</div>
                           	<div class="form-group">
                            	<label class="col-sm-3 control-label">Sumber Produk</label>
                              	<div class="col-sm-9">
									<select class="transProd-companyProductFrom chosen-select chosen-transparent form-control" th:field="*{companyProductFrom.pkCompanyProduct}">
                                    	<option th:each="opt : ${optionsProductInStock}" th:value="${opt.pkCompanyProduct}" th:text="${opt.name}"></option>
                                 	</select>
                              	</div>
                           	</div>
                           	<div class="form-group">
                            	<label class="col-sm-3 control-label">Tujuan Produk</label>
                              	<div class="col-sm-9">
									<select class="transProd-companyProductTo chosen-select chosen-transparent form-control" th:field="*{companyProductTo.pkCompanyProduct}">
                                    	<option th:each="opt : ${optionsProductBBP}" th:value="${opt.pkCompanyProduct}" th:text="${opt.name}"></option>
                                 	</select>
                              	</div>
                           	</div>
                           	<div class="form-group">
                           		<label class="col-sm-3 control-label">Stok yang diolah</label>
	                        	<div class="col-sm-9">
	                        		<input type="hidden" th:field="*{stockFrom.pkStock}" id="stockFromPkStock"/>
		                        	<button type="button" id="choose-stock" class="btn btn-primary" style="display: inline-block;">Pilih Stok</button>
								</div>
							</div>
							<div class="form-group">
								<div class="col-sm-12">
									<div class="input-group input-group-sm" style="width:100%;">
									<!-- tile -->
	                					<section class="tile color transparent-white">
	                  					<!-- tile body -->
	                  						<div class="tile-body transparent rounded-corners">
	                  							<input type="hidden" id="hpp-from"/>
	                   							<table class="table table-custom table-sortable transProd-table-stock" style="width:100%;">
					 								<thead>
								                        <tr>
								                          <th style="width:3%">No.</th>
								                          <th style="width:15%">Tanggal Pembelian</th>
								                          <th style="width:15%">Supplier</th>
								                          <th style="width:15%">Volume Saat Ini</th>
								                          <th style="width:14%">Volume Olah</th>
								                        </tr>
								                    </thead>
	                     							<tbody></tbody>
				  								  	<tfoot>
								                        <tr>
								                          <th colspan="4">Total</th>
								                          <th>
															<div class="input-group input-group-sm">
																<input type="text" class="form-control total-volume-olah" readonly='readonly'/>
																<span class="input-group-addon addon-greensea">Kg</span>
															</div>
								                          </th>
								                        </tr>
							                      	</tfoot>
	                   							</table>
					                 		</div>
						                  <!-- /tile body -->
					                </section>
					                <!-- /tile --> 
									</div>
	                       		</div>
	                      	</div>
                     	</div>
                     	<!-- END STEP #2 -->
                     	
                     	<!-- STEP #3 -->
                     	<div class="tab-pane" id="step3">
                     		<div class="form-group">
                            	<label class="col-sm-3 control-label">Pengolahan</label>
                              	<div class="col-sm-9">
                              		<label class="control-value"><span class="title-companyProductFrom"></span> -> <span class="title-companyProductTo"></span></label>
                              	</div>
                           	</div>
                     		<div class="form-group mandiri-content">
		                        <div class="col-sm-12">
								<a href="#" class="btn btn-primary transProd-machinery-table-add" data-toggle="tooltip" title="Tambah"><i class="fa fa-plus dropdown-plus"></i> Tambah</a>
								<section class="tile color transparent-white">
									<div class="tile-body transparent rounded-corners">
		                           		<table class="table table-custom table-sortable transProd-machinery-table">
			                            	<thead>
												<tr>
			                                    	<th style="width:25%">Sumber Produk</th>
			                                    	<th style="width:25%">Mesin</th>
			                                    	<th style="width:25%">Hasil Produk</th>
			                                    	<th style="width:22%">Kapasitas</th>
			                                    	<th style="width:3%">&nbsp;</th>
			                                 	</tr>
			                              	</thead>
			                              	<tbody>
			                              		<th:block th:if="*{not #lists.isEmpty(machineries)}" >
			                              			
			                              		</th:block>
			                              	</tbody>
		                           		</table>
	                           		</div>
	                           	</section>
	                     		</div>
                     		</div>
                     		<div class="form-group mandiri-content">
                            	<label class="col-sm-3 control-label">Perkiraan Lama Pengolahan</label>
                              	<div class="col-sm-9">
                              		<input type="hidden" class="est-day-input" th:value="${estDays}" />
                              		<label style="padding-top:7px"><span id="est-day">0</span> Hari</label>
                              	</div>
                           	</div>
                           	<div class="form-group third-party-content">
                           		<label class="col-sm-3 control-label">Perkiraan Lama Pengolahan</label>
                           		<div class="col-sm-9">
	                           		<div class="input-group input-group-sm">
	                           			<input type="text" class="form-control est-day-input" th:value="${estDays}" />
	                           			<span class="input-group-addon addon-greensea">Hari</span>
	                           		</div>
								</div>
							</div>
                     	</div>
                     	<!-- END STEP #3 -->
                     	<!-- STEP #4 -->
                     	<div class="tab-pane" id="step4">
                     		<div class="form-group">
		                        <div class="col-sm-12">
								<a href="#" class="btn btn-primary table-fee-add" data-toggle="tooltip" title="Tambah"><i class="fa fa-plus dropdown-plus"></i> Tambah</a>
								<section class="tile color transparent-white">
									<div class="tile-body transparent rounded-corners">
		                           		<table id="table-fee" class="table table-custom table-sortable">
			                            	<thead>
												<tr>
			                                    	<th style="width:50%">Item Biaya</th>
			                                    	<th>Harga</th>
			                                    	<th style="width: 30px;"></th>
			                                 	</tr>
			                              	</thead>
			                              	<tbody>
			                              		<th:block th:if="*{#lists.isEmpty(fees)}" >
				                                	<tr>
				                                    	<td>
				                                       		<div class="input-group" style="width:100%">
				                                          		<input type='text' class='form-control fee-descr'/>
				                                       		</div>
				                                    	</td>
				                                    	<td>
				                                       		<div class="input-group">
				                                          		<span class="input-group-addon addon-greensea">Rp</span>
				                                          		<input type="text" class="form-control fee numeric"/>
				                                       		</div>
				                                    	</td>
				                                    	<td class="text-center">
				                                    		<a href="#" class="btn btn-primary btn-xs margin-bottom-20 fee-delete-row" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></a>
				                                    	</td>
				                                 	</tr>
				                                 </th:block>
				                                 <th:block th:if="*{not #lists.isEmpty(fees)}" >
			                              			<tr th:each="item : *{fees}">
			                              				<td>
				                                       		<div class="input-group" style="width:100%">
				                                       			<input type='hidden' class="pk-fee" th:value="${item.pkTransProdFee}"/>
				                                          		<input type='text' class='form-control fee-descr' th:value="${item.descr}"/>
				                                       		</div>
				                                    	</td>
				                                    	<td>
				                                       		<div class="input-group">
				                                          		<span class="input-group-addon addon-greensea">Rp</span>
				                                          		<input type="text" class="form-control fee numeric" th:value="${item.fee}"/>
				                                       		</div>
				                                    	</td>
				                                    	<td class="text-center">
				                                    		<a href="#" class="btn btn-primary btn-xs margin-bottom-20 fee-delete-row" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></a>
				                                    	</td>
			                              			</tr>
			                              		 </th:block>
			                              	</tbody>
			                              	<tfoot>
			                                	<tr>
				                                    <th>Total biaya yg dikeluarkan</th>
			            	                    	<th>
			            	                    		<div class="input-group">
			                                          		<span class="input-group-addon addon-greensea">Rp</span>
			                                          		<input type="text" id="total-fee" class="form-control numeric" readonly="readonly"/>
			                                       		</div>
			            	                    	</th>
			            	                    	<th></th>
			            	                    </tr>
			                              	</tfoot>
		                           		</table>
	                           		</div>
	                           	</section>
	                     		</div>
                     		</div>
                     	</div>
                     	
                     	<div class="tab-pane" id="step5">
                     		<div class="form-group">
                            	<label class="col-sm-4 control-label" style="text-align:left">Hasil Pengolahan Utama</label>
                              	<div class="col-sm-8"></div>
                           	</div>
                     		<div class="form-group">
		                        <div class="col-sm-12">
								<section class="tile color transparent-white">
									<div class="tile-body transparent rounded-corners">
		                           		<table class="table table-custom table-sortable transIn-table-masterFee">
			                            	<thead>
												<tr>
													<th>Tanggal</th>
			                                    	<th style="width:50%">dari <strong class="title-companyProductFrom">Gabah Kering Panen</strong></th>
			                                    	<th>menjadi</th>
			                                    	<th style="width:50%"><strong class="title-companyProductTo">Beras Premium</strong></th>
			                                 	</tr>
			                              	</thead>
			                              	<tbody>
				                                	<tr>
				                                		<td class="text-center"><label style="padding-top:7px">17.Mei.2016</label></td>
				                                    	<td>
				                                       		<div class="input-group">
				                                          		<input type="text" class="form-control used-volume-result numeric" readonly="readonly"/>
				                                          		<span class="input-group-addon addon-greensea">Kg</span>
				                                       		</div>
				                                    	</td>
				                                    	<td class="text-center" style="padding-top:7px"><i class="fa fa-arrow-right" aria-hidden="true"></i></td>
				                                    	<td>
				                                       		<div class="input-group">
				                                          		<input type="text" class="form-control main-volume-result numeric" th:field="*{volumeToInKg}"/>
				                                          		<span class="input-group-addon addon-greensea">Kg</span>
				                                       		</div>
				                                       		<div class="input-group" style="padding:7px 0px">
				                                          		<strong>Nilai Stock Persatuan</strong>
				                                       		</div>
				                                       		<div class="input-group">
				                                       			<span class="input-group-addon addon-greensea">Rp</span>
				                                          		<input type="text" class="form-control main-hpp numeric" readonly="readonly"/>
				                                          		<span class="input-group-addon addon-greensea">/ Kg</span>
				                                       		</div>
				                                    	</td>
				                                 	</tr>
				                             </tbody>
		                           		</table>
	                           		</div>
	                           	</section>
	                     		</div>
                     		</div>
                     		<div class="form-group">
                            	<label class="col-sm-3 control-label">Hasil Utama disimpan di Gudang</label>
                              	<div class="col-sm-9">
                              		<select class="warehouse-main-select chosen-select chosen-transparent form-control" th:field="*{companyWarehouseMain.pkCompanyWarehouse}">
										<option th:each="opt : ${optionsWarehouse}" th:value="${opt.pkCompanyWarehouse}" th:text="${opt.name}"></option>
							   		</select>
                              	</div>
                           	</div>
                           	<hr/>
	                      	<div class="form-group">
                            	<label class="col-sm-4 control-label" style="text-align:left">Hasil Lain</label>
                              	<div class="col-sm-8">
                              	</div>
                           	</div>
	                      	<div class="form-group">
		                        <div class="col-sm-12">
								<a href="#" class="btn btn-primary other-result-table-add" data-toggle="tooltip" title="Tambah"><i class="fa fa-plus dropdown-plus"></i> Tambah</a>
								<section class="tile color transparent-white">
									<div class="tile-body transparent rounded-corners">
		                           		<table class="table table-custom table-sortable other-result-table">
			                            	<thead>
												<tr>
			                                    	<th style="width:50%">Produk</th>
			                                    	<th>Volume</th>
			                                    	<th style="width: 30px;"></th>
			                                 	</tr>
			                              	</thead>
			                              	<tbody>
				                                	<tr>
				                                    	<td>
				                                       		<div class="input-group" style="width:100%;">
				                                          		<select class="other-item-product chosen-select chosen-transparent form-control">
							                                    	<option th:each="opt : ${optionsProductBBP}" th:value="${opt.pkCompanyProduct}" th:text="${opt.name}"></option>
							                                 	</select>
				                                       		</div>
				                                    	</td>
				                                    	<td>
				                                       		<div class="input-group">
				                                          		<input type="text" class="form-control other-item-volume numeric"/>
				                                          		<span class="input-group-addon addon-greensea">Kg</span>
				                                       		</div>
				                                    	</td>
				                                    	<td class="text-center"><a href="#" class="btn btn-primary btn-xs margin-bottom-20 transIn-table-masterFee-delete-row" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></a></td>
				                                 	</tr>
			                              	</tbody>
		                           		</table>
	                           		</div>
	                           	</section>
	                     		</div>
                     		</div>
                     		<div class="form-group">
                            	<label class="col-sm-3 control-label">Hasil Lain disimpan di Gudang</label>
                              	<div class="col-sm-9">
                              		<select class="warehouse-other-select chosen-select chosen-transparent form-control" th:field="*{companyWarehouseOther.pkCompanyWarehouse}">
										<option th:each="opt : ${optionsWarehouse}" th:value="${opt.pkCompanyWarehouse}" th:text="${opt.name}"></option>
							   		</select>
                              	</div>
                           	</div>
                     	</div>
                     	
                     	<div class="wizard-actions form-group form-footer" style="background-color : rgba(0, 0, 0, 0.3)">
		                	<div class="col-sm-offset-2 col-sm-10">
		                		<button type="button" id="transProd-detail-btn-cancel" class="btn btn-default">
									<i class="icon-arrow-left"></i>Batal
								</button>
			                	<button type="button" id="transProd-detail-btn-back" class="btn btn-default">
									<i class="icon-arrow-left"></i>Kembali
								</button>
								<button type="button" id="transProd-detail-btn-next" class="btn btn-primary">
									Lanjut
									<i class="icon-arrow-right icon-on-right"></i>
								</button>
								<button type="button" id="transProd-detail-btn-save" class="btn btn-primary">
									Simpan
									<i class="icon-arrow-right icon-on-right"></i>
								</button>
								<button type="button" id="transProd-detail-btn-save-add-to-stock" class="btn btn-primary">
									Selesai &amp; Masukan hasil kedalam stock
									<i class="icon-arrow-right icon-on-right"></i>
								</button>
							</div>
						</div>
					</div>
				</form>
			</div>
	</section>
	</div>
</div>
	<div id="master-trans-prod" style="display:none">
		<div id="select-machinery">
			<input type="hidden" class="transProd-machinery-pk"/>
			<input type="hidden" class="transProd-machinery-orderNo"/>
			<select class="transProd-machinery-select chosen-select chosen-transparent form-control">
				<option value="">[ Pilih Mesin ]</option>
	      		<option th:each="opt : ${machineryList}" th:value="${opt.pkCompanyMachinery}" th:text="${opt.name}" th:attr="productfromid=${opt.companyProductFrom.pkCompanyProduct},productfrom=${opt.companyProductFrom.name},producttoid=${opt.companyProductTo.pkCompanyProduct},productto=${opt.companyProductTo.name},capacity=${opt.capacity},weightingid=${opt.weighting.pkLookup},weightingcode=${opt.weighting.code},weightingnameid=${opt.weighting.nameId},uomcode=${opt.capacityUOM.code},uomnameid=${opt.capacityUOM.nameId}"></option>
	   		</select>
   		</div>
   		
   		<div id="master-table-fee">
   			<table>
   				<tbody>
	   				<tr>
		               	<td>
	                  		<div class="input-group" style="width:100%">
	                     		<input type='text' class='form-control fee-descr'/>
	                  		</div>
		               	</td>
		               	<td>
	                  		<div class="input-group">
	                     		<span class="input-group-addon addon-greensea">Rp</span>
	                     		<input type="text" class="form-control fee numeric"/>
	                  		</div>
		               	</td>
		               	<td class="text-center">
		               		<a href="#" class="btn btn-primary btn-xs margin-bottom-20 fee-delete-row" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></a>
		               	</td>
	            	</tr>
				</tbody>
   			</table>
   		</div>
   		
   		<div id="master-other-result">
   		<table>
   			<tbody>
   				<tr>
               		<td>
                  		<div class="input-group" style="width:100%;">
                     		<select class="transProd-product-select chosen-select chosen-transparent form-control">
                  				<option th:each="opt : ${optionsProductBBP}" th:value="${opt.pkCompanyProduct}" th:text="${opt.name}"></option>
               				</select>
                  		</div>
               		</td>
               		<td>
                  		<div class="input-group">
                     		<input type="text" class="form-control transIn-table-masterFee-fee numeric"/>
                     		<span class="input-group-addon addon-greensea">Kg</span>
                  		</div>
               		</td>
               		<td class="text-center">
               			<a href="#" class="btn btn-primary btn-xs margin-bottom-20 transIn-table-masterFee-delete-row" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></a>
               		</td>
            	</tr>
   			</tbody>
   		</table>
   		</div>
	</div>
	<!-- Modal -->
	<div class="modal fade" id="stockModal" tabindex="-1" role="dialog" aria-labelledby="stockModalLabel">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="stockModalLabel">Cari Stok (<span id="stock-modal-header"></span>)</h4>
	      </div>
	      <div class="modal-body">
	      	<div class="row">
	      		<div class="col-md-12">
	      		<form action="#" class="form-horizontal" method="POST" id="choose-stock-form">
					<div class="form-group">
						<label class="col-sm-5 control-label" th:text="'Sumber Produk'"></label>
						<label class="col-sm-7 control-value" id="sumber-produk"></label>
					</div>
					<div class="form-group">
						<label class="col-sm-5 control-label" th:text="'Pemasok'"></label>
						<div class="col-sm-7 form-input-container">
							<select class="chosen-select chosen-transparent form-control" id="pemasok">
							</select>
						</div>
					</div>
					<hr></hr>
					<div class="col-md-12">
			      		<div class="form-group">	
			      			<table id="choose-stock-table" class='table table-custom table-sortable'>
								<thead>
									<tr>
										<th>No</th>
										<th>Tanggal <span id="title-table-penerimaan"></span></th>
										<th>Stok Saat Ini</th>
										<th>Nilai Stock Persatuan</th>
										<th>&nbsp;</th>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</div>
					</div>
				</form>
				</div>
	      	</div>
	      </div>
	    </div>
	  </div>
	</div>
	<script th:inline="javascript">
	/*<![CDATA[*/
	    $(function(){
	    	var buyCode = /*[[${inSourceTypeBuying}]]*/ #;
		    var maklonCode = /*[[${inSourceTypeMaklon}]]*/ #;
		    
		    var actorMandiri = /*[[${actorMandiri}]]*/ #;
		    var actorThirdParty = /*[[${actorThirdParty}]]*/ #;
		    
		    var day = /*[[${day}]]*/ #;
		    var month = /*[[${month}]]*/ #;
		    var year = /*[[${year}]]*/ #;
		    
	    	var initWizard = function(id,idbtncancel,idbtnprev,idbtnnext,idbtnfinish,idbtnfinishaddtostock){
	    		$('.tab-pane').hide();
	    		var liLength = $('#'+id+' ul.wizard-steps li').length;
	    		
	    		$('#'+id+' ul.wizard-steps li').each(function(){
	    			$(this).css('width',100/parseInt(liLength)+'%').click(function(){
	    				$(this).removeClass('complete').addClass('active').prevAll().switchClass('active','complete');
	    				$(this).nextAll().removeClass('active complete');
	    				$('.wizard-actions button#'+idbtncancel).hide();
	    				$('.wizard-actions button#'+idbtnprev).hide();
	    				$('.wizard-actions button#'+idbtnnext).hide();
	    				$('.wizard-actions button#'+idbtnfinish).hide();
	    				$('.wizard-actions button#'+idbtnfinishaddtostock).hide();
	    				if($(this).is(':first-child')){
	    					$('.wizard-actions button#'+ idbtncancel).show();	
	    				}else{
	    					$('.wizard-actions button#'+ idbtnprev).show();	
	    				}
	    				if($(this).is(':last-child')){
	    					$('.wizard-actions button#'+ idbtnfinish).show();
	    					$('.wizard-actions button#'+ idbtnfinishaddtostock).show();
	    				}else{
	    					$('.wizard-actions button#'+ idbtnnext).show();
	    				}
	    	  			$('.tab-pane').hide();
	    	  			$('#'+$(this).attr('data-target')).show();
	    	  		});
	    	  	});
	    		$('.wizard-actions button#'+idbtncancel).click(function(e){
	    			e.preventDefault();
	    			backToList();
	    		});
	    		$('.wizard-actions button#'+idbtnprev).click(function(e){
	    			e.preventDefault();
	    			$('#'+id+' ul.wizard-steps li.active:not(.complete)').prev().trigger('click');
	    			cleanErrorParsley(3);
	    		});
				$('.wizard-actions button#'+idbtnnext).click(function(e){
					e.preventDefault();
					$('#'+id+' ul.wizard-steps li.active:not(.complete)').next().trigger('click');
					cleanErrorParsley(3);
				});
				$('.wizard-actions button#'+idbtnfinish).click(function(e){
					e.preventDefault();
					cleanErrorParsley(3);
					submitForm(0);
				});
				$('.wizard-actions button#'+idbtnfinishaddtostock).click(function(e){
					e.preventDefault();
					cleanErrorParsley(3);
					submitForm(1);
				});
	    	  	$('#'+id+' ul.wizard-steps').children().eq(0).trigger('click');
	    	};
	    	
	    	initWizard('padiku-wizard','transProd-detail-btn-cancel','transProd-detail-btn-back',
	    			'transProd-detail-btn-next','transProd-detail-btn-save','transProd-detail-btn-save-add-to-stock');
	    	
	    	$('.datepicker').datepicker({
	    	    autoclose: true,
	    	    todayHighlight: true,
	    		format: 'dd.mm.yyyy',
	    		onSelect: function(dateText, datePicker) {
	    			$(this).attr('value', dateText);
    		    }
            }).datepicker("setDate", new Date(year,month,day));
	    	
	    	var init = function(){
	    		$('input[name=transInSourceType][value=BUY]').trigger('click');
	    		$('.title-companyProductFrom').text($('.transProd-companyProductFrom option:selected').text());
	    		$('.title-companyProductTo').text($('.transProd-companyProductTo option:selected').text());
	    	};
	    	init();
	    	
	    	var actorProdChange = function(){
	    		$('.mandiri-content').hide();
	    		$('.third-party-content').hide();
	    		if($('.transProd-actor-prod:checked').val()==actorThirdParty){
	    			$('#produsen-content').show();
	    			$('.third-party-content').show();
	    		}else{
	    			$('#produsen-content').hide();
	    			$('.mandiri-content').show();
	    		}
	    	};
	    	
	    	$('.transProd-actor-prod').change(function(){
	    		actorProdChange();	
	    	});
	    	actorProdChange();
	    	
	    	$('.transProd-companyProductFrom').change(function(){
	    		$('.title-companyProductFrom').text($('.transProd-companyProductFrom option:selected').text());
	    	});
	    	
	    	$('.transProd-companyProductTo').change(function(){
	    		$('.title-companyProductTo').text($('.transProd-companyProductTo option:selected').text());
	    	});
	    	
	    	var populateSupplier = function(sumberTransIn){
	    		var sURL = /*[[@{/do/pengolahan/getSuplierInStock?}]]*/ #;
				sURL += "pkCompanyProduct=" + $('.transProd-companyProductFrom').val() + "&tiSourceType=" + (sumberTransIn);
				$.get(sURL, function(data) {
					var options = "<option value=''>[ Pilih Pemasok ]</option>";
					if(data) {
						for(var i=0;i<data.length;i++) {
							options += '<option value="'+data[i].pkParty+'">'+data[i].name+'</option>'
						}
					}
					$('#pemasok').html(options);
				});
	    	};
	    	
	    	var calcUsedVolume = function(){
	    		$('.transProd-table-stock .used-volume').change(function(){
	    			var total = 0;
	    			$('.transProd-table-stock .used-volume').each(function(){
	    				total += parseFloat($(this).val());
	    			});
	    			$('.transProd-table-stock .total-volume-olah').val(total);
	    			$('.used-volume-result').val($(this).val());
	    		});
	    	};
	    	
	    	var pickToList = function(obj){
	    		$('#stockFromPkStock').val(obj.attr('key'))
	    		$('#stockModal').modal('hide');
	    		$('#hpp-from').val(obj.attr('hpp'));
	    		var parent = obj.parent().parent();
	    		var html = '';
	    		html +='<tr>';
	    		html +='<td>1</td>';
	    		html +='<td>'+parent.children().eq(1).text()+'</td>';
	    		html +='<td>'+$('#pemasok option:selected').text()+'</td>';
	    		html +='<td>';
	    		html +='<div class="input-group input-group-sm">';
	    		html +='<input type="text" class="form-control" value="'+obj.attr('remainingVolume')+'" readonly="readonly">';
	    		html +='<span class="input-group-addon addon-greensea">Kg</span>';
	    		html +='</div>';
	    		html +='</td>';
	    		html +='<td>';
	    		html +='<div class="input-group input-group-sm">';
	    		html +='<input type="text" class="form-control used-volume">';
	    		html +='<span class="input-group-addon addon-greensea">Kg</span>';
	    		html +='</div>';
	    		html +='</td>';
	    		html +='</tr>';
	    		$('.transProd-table-stock tbody').html(html);
	    		calcUsedVolume();
	    	}
	    	$('#pemasok').change(function(){
	    		var sURL = /*[[@{/do/pengolahan/getStockListByFilter?}]]*/ #;
				sURL += "pkCompanyProduct=" + $('.transProd-companyProductFrom').val() + "&tiSourceType=" + $('input[name=transInSourceType]:checked').val() + "&pkTiThirdParty=" + $(this).val();
				var idx = 1;
				$.get(sURL, function(data) {
					if(data) {
						var html = '';
						for(var i=0;i<data.length;i++) {
							html += "<tr>";
							html += "<td>"+idx+"</td>";
							html += "<td>"+data[i].transIn.inDateString+"</td>";
							html += "<td style='text-align:right'>"+data[i].remainingVolumeInKg+" Kg</td>";
							html += "<td style='text-align:right'>Rp "+data[i].hpp+" / Kg</td>";
							html += "<td><button type='button' class='btn btn-primary pick-stock-to-list' key='"+data[i].pkStock+"' remainingVolume='"+data[i].remainingVolumeInKg+"' hpp='"+data[i].hpp+"'>Pilih</button></td>";
							html += "</tr>";
							idx++;
						}
					}
					$('#choose-stock-table tbody').html(html);
					$('.pick-stock-to-list').click(function(){
						pickToList($(this));
					});
				});
			});
	    	
	    	$('#choose-stock').click(function(){
	    		$('#choose-stock-table tbody').html('');
	    		var sumberTransIn = $('input[name=transInSourceType]:checked').val();
	    		populateSupplier(sumberTransIn);
	    		if(sumberTransIn == maklonCode){
	    			$('#stock-modal-header').text('Penerimaan - Maklon');
	    			$('#title-table-penerimaan').text('Maklon');
	    		}else{
	    			$('#stock-modal-header').text('Penerimaan - Pembelian');
	    			$('#title-table-penerimaan').text('Pembelian');
	    		}
	    		$('#sumber-produk').text($('.transProd-companyProductFrom option:selected').text());
	    		$('#stockModal').modal('show');
	    	});
	    	
	    	var calcEstDay = function(){
	    		var estDay = 0;
	    		var usedVol = parseFloat($('.used-volume').val());
	    		$('.transProd-machinery-table tbody tr').each(function(){
					var select = $(this).find('.transProd-machinery-select option:selected');
					//if(select.attr('uomcode')=="D"){
						var capacity = parseFloat(select.attr('capacity'));
						var div = usedVol/capacity;
						if(div>parseInt(div)){
							estDay = parseInt(div)+1;
						}else{
							estDay = parseInt(div);
						}
						$('#est-day').text(estDay);
					//}
	    		});
	    	};
	    	
	    	$('.transProd-machinery-table-add').click(function(){
	    		var sumberProduct = null;
	    		var sumberProductId = null;
	    		if($('.transProd-machinery-table tbody tr').length>0){
	    			var trLast = $('.transProd-machinery-table tbody tr:last');
	    			sumberProduct = trLast.find('.machinery-tujuan-product').text();
	    			sumberProductId = trLast.find('.transProd-machinery-select option:selected').attr('producttoid');
	    		}else{
	    			sumberProduct = $('.transProd-companyProductFrom option:selected').text();
		    		sumberProductId = $('.transProd-companyProductFrom').val();
	    		}
	    		cleanErrorParsley(3);
	    		if($('.transProd-machinery-select option[productfromid='+sumberProductId+']').length==0){
	    			displayErrorParsley([{error:"Tidak ada mesin yang bisa memproses sumber produk : "+sumberProduct}], 3);
	    		}else{
		    		var html = '<tr>';
	            	html += '<td class="machinery-sumber-product">'+sumberProduct+'</td>';
	            	html += '<td>'+$('#master-trans-prod #select-machinery').html()+'</td>';
	            	html += '<td class="machinery-tujuan-product"></td>';
	            	html += '<td class="machinery-capacity"></td>';
	            	html += '<td class="text-center"><a href="#" class="btn btn-primary btn-xs margin-bottom-20 machinery-delete-row" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></a></td>';
	            	html += '</tr>';
	            	$('.transProd-machinery-table tbody').append(html);
	            	var objSelect = $('.transProd-machinery-table tbody tr:last select.transProd-machinery-select');
	            	objSelect.find('option[productfromid!='+sumberProductId+']').hide();
	            	objSelect.find('option[value=""]').show();
	            	objSelect.change(function(){
	            		var parentSelect = $(this).parent().parent();
	            		var selected = $(this).find('option:selected');
	            		parentSelect.find('.machinery-tujuan-product').text(selected.attr('productto'));
	            		
	            		var capacity = selected.attr('capacity');
	            		var weightingnameid = selected.attr('weightingnameid');
	            		var uomnameid = selected.attr('uomnameid');
	            		parentSelect.find('.machinery-capacity').text(capacity+" "+weightingnameid+" / "+uomnameid);
	            		calcEstDay();
	            	});
	    		}
	    	});
	    	
	    	$('.other-result-table-add').click(function(){
	    		$('.other-result-table tbody').append($('#master-other-result tbody').html());
	    	});
	    	
	    	var calcTotalFee = function(){
	    		$('#table-fee tbody tr input.fee').change(function(){
	    			var totalFee = 0;
	    			$('#table-fee tbody tr input.fee').each(function(){
	    				if($(this).val()!=""){
	    					totalFee += parseFloat($(this).val());
	    				}
	    			});
	    			$('#table-fee #total-fee').val(totalFee);
	    		});
	    	};
	    	
	    	var deleteRowFee = function(){
	    		$('.fee-delete-row').click(function(){
	    			$(this).parent().parent().remove();
	    		});
	    	};
	    	
	    	$('.table-fee-add').click(function(){
	    		$('#table-fee tbody').append($('#master-trans-prod #master-table-fee tbody').html());
	    		calcTotalFee();
	    		deleteRowFee();
	    	});
	    	
	    	calcTotalFee();
    		deleteRowFee();
    		
    		var preSerialize = function(finish) {
    			if(finish==0){
    				$('#transProd-detail-status').val(1);
    			}else{
    				$('#transProd-detail-status').val(2);
    			}
    			$('.transProd-table-stock .used-volume').attr('name','volumeInKg');
    			if($('.transProd-actor-prod:checked').val()==actorThirdParty){
    				$('.mandiri-content .est-day-input').attr('name','estDays').val($('#est-day').text());
    			}else{
    				$('.third-party-content .est-day-input').attr('name','estDays').val($('#est-day').text());
    			}
    			var idxF = 0;
				$('#table-fee tbody tr').each(function(){
					if($(this).find('.pk-fee').length>0){
						$(this).find('.pk-fee').attr('name', 'fees['+idxF+'].pkTransProdFee');
					}
					$(this).find('.fee-descr').attr('name', 'fees['+idxF+'].descr');
					$(this).find('.fee').attr('name', 'fees['+idxF+'].fee');
					idxF++;
				});
				
				var idxM = 0;
				$('.transProd-machinery-table tbody tr').each(function(){
					$(this).find('.transProd-machinery-pk').attr('name', 'machineries['+idxM+'].pkTransProdMachinery');
					$(this).find('.transProd-machinery-orderNo').attr('name', 'machineries['+idxM+'].orderNo').val(idxM+1);
					$(this).find('.transProd-machinery-select').attr('name', 'machineries['+idxM+'].companyMachinery.pkCompanyMachinery');
					idxM++;
				});
				
				var idxO = 0;
				$('.other-result-table tbody tr').each(function(){
					$(this).find('.other-item-product').attr('name', 'otherItems['+idxO+'].companyProduct.pkCompanyProduct');
					$(this).find('.other-item-volume').attr('name', 'otherItems['+idxO+'].volumeInKg');
					idxO++;
				});
    		};
    		
    		var calcHpp = function(){
    			var hppFrom = parseFloat($('#hpp-from').val());	
    			var usedVol = parseFloat($('.used-volume').val());
    			var otherFee = 0;
    			$('#table-fee tbody tr').each(function(){
					otherFee += parseFloat($(this).find('.fee').val());
				});
    			$('.main-hpp').val(parseFloat(((hppFrom * usedVol) + otherFee) /usedVol)); 
    		}
    		
    		$('.main-volume-result').change(function(){
    			calcHpp();
    		})
    		
    		var backToCalendar = function(){
				returnToList('transProd-detail-container', 'transProd-calendar-container', false);
			};
			
    		var submitForm = function(finish){
				var sURL = /*[[@{/do/pengolahan/saveTransProd/}]]*/ #;
				preSerialize(finish);
				$.post(sURL, $("#transProd-detail-form").serialize(), function(data) {
					if(data.errorList!=null){
						displayErrorParsley(data.errorList, 3);
					}else{
						backToCalendar();
						$('#calendar').fullCalendar('refetchEvents');
					}
				});
    		};
	    });
	/*]]>*/
	</script>
</body>
</html>