<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:ifs="http://btn.co.id">
<head>
<meta charset="ISO-8859-1"/>
<title>TransIn</title>
<style>
.ui-datepicker {
	z-index : 10;
}
</style>
</head>
<body>
<div id="padiku-wizard">
	<div class="pageheader">
		<div class="row col-md-8">
			<h4><i class="fa fa-tachometer"></i> Penerimaan / Tambah Penerimaan<span></span></h4>
		</div>
		<!-- Wizard Section -->
		<div class="wizard-tab-container row-fluid col-md-8">
	    	<ul class="wizard-steps">
	        	<li data-target="step1" class="active">
					<span class="step">1</span>
					<span class="title">Informasi Penerimaan</span>
	            </li>
	            <li data-target="step2">
	             	<span class="step">2</span>
	             	<span class="title">Detail Penerimaan</span>
	            </li>
	            <li data-target="step3">
	             	<span class="step">3</span>
	                <span class="title">Biaya-biaya</span>
				</li>
			</ul>
		</div>
	</div>
	<div  class="row col-md-8">
		<section class="tile transparent">
			<div class="tile-body color step-content position-relative">
				<form action="#" id="transIn-detail-form" class="form-horizontal" method="POST" novalidate="novalidate" th:object="${detail}">
					<div class="stockTypeStyle">
						<div class="form-group">
							<div class="col-md-12">
								<div id="errorFragmentList3">
									<th:block th:if="${message}">
										<div class='alert alert-success'>
											<a href='#' class='close' data-dismiss='alert' aria-label='close' title='close'>&#10006;</a>			
											<label th:text="${message}"></label>
										</div>
									</th:block>
								</div>
							</div>									
						&nbsp;
						</div>
						<input id="transIn-detail-maintenancePk" type="hidden" th:field="*{pkTransIn}"/>
						<!-- STEP #1 -->
						<div class="active tab-pane" id="step1">
                           	<div class="form-group">
                              	<label class="col-sm-3 control-label" th:text="'No. Pembelian'">No. Penerimaan</label>
                              	<div class="col-sm-9">
                                	<label th:if="*{inNo == null}" class="control-value" th:text="'Generated By System'"></label>
                              		<label th:if="*{inNo != null}">
                              			<input type="text" class="form-control" th:field="*{inNo}" readonly="readonly"/>
                              		</label>
                              	</div>
                           	</div>
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input01">Jenis Penerimaan</label>
                             	<div class="col-sm-9 form-input-container">
									<div class="btn-group" data-toggle="buttons">
							   			<label class="btn btn-primary active transIn-radio-type-button">
							   				<input type="radio" class="transIn-radio-type" th:field="*{sourceType}" th:value="${transInTypeBuying}" checked="checked"/> Pembelian
							   			</label>
										<label class="btn btn-primary transIn-radio-type-button">
											<input type="radio" class="transIn-radio-type" th:field="*{sourceType}" th:value="${transInTypeMaklon}"/> Maklon
										</label>
									</div>
                             	</div>
                           	</div>
                           	<div class="form-group">
								<label class="col-sm-3 control-label">Nama Pemasok</label>
                              		<div class="col-sm-9 form-input-container">
                                 		<select class="chosen-select form-control" th:field="*{thirdParty.pkParty}">
                                 			<option value="">[ Pilih Pemasok ]</option>
                                    		<option th:each="opt : ${optionsSupplier}" th:value="${opt.pkParty}" th:text="${opt.name}"></option>
                                 		</select>
                              		</div>
                           	</div>
                           	<div class="form-group transIn-show-when-buy-only">
                            	<label for="input07" class="col-sm-3 control-label">Jenis Pembayaran</label>
                              	<div class="col-sm-9">
                                	<select class="chosen-select chosen-transparent form-control" th:field="*{termOfPayment.pkCompanyLookup}">
                                		<option value="">[ Pilih Jenis Pembayaran ]</option>
                                    	<option th:each="opt : ${optionsTermOfPayment}" th:value="${opt.pkCompanyLookup}" th:text="${opt.nameId}"></option>
                                 	</select>
                              	</div>
                           	</div>
                           	<div class="form-group">
                              	<label class="col-sm-3 control-label">Tanggal Penerimaan</label>
                              	<div class="col-sm-9">
                                	<input type='text' class="datepicker input-date form-control" th:field="*{inDate}"/>
                              	</div>
                           	</div>
                     	</div>
                     	<!-- END STEP #1 -->
                     	
                     	<!-- STEP #2 -->
						<div class="tab-pane" id="step2">
							<div class="form-group">
								<label class="col-sm-3 control-label">Jenis Barang/Bahan</label>
                            	<div class="col-sm-9">
									<div class="btn-group transIn-show-when-buy-only" data-toggle="buttons">
								   		<label class="btn btn-primary active transIn-radio-item-type-button">
								   			<input type="radio" class="transIn-radio-item-type" th:field="*{itemTypeCategory}" th:value="${usageItemTypeBBP}"/> Bahan Baku Produksi
								   		</label>
										<label class="btn btn-primary transIn-radio-item-type-button">
											<input type="radio" class="transIn-radio-item-type" th:field="*{itemTypeCategory}" th:value="${usageItemTypeBPP}"/> Barang Penunjang Produksi
										</label>
									</div>
									<div class="btn-group transIn-show-when-makloon-only" style="display:none;">
										<label th:text="'Bahan Baku Produksi'"></label>
									</div>
                              	</div>
                           	</div>
                           	<div class="form-group product-section-non-list">
                            	<label class="col-sm-3 control-label">Nama Barang</label>
                              	<div class="col-sm-9">
									<select class="transIn-select-companyProduct preSerialize-remove chosen-select chosen-transparent form-control">
										<option value="">[ Pilih Nama Barang ]</option>
										<option th:each="opt : ${optionsProductBBP}" th:attr="buyingPrice=${opt.buyingPrice},uom=${opt.uom.pkLookup}" 
										 th:value="${opt.pkCompanyProduct}" th:text="${opt.name}" th:selected="${opt.pkCompanyProduct == bbpItem.companyProduct?.pkCompanyProduct}"></option>
									</select>
                              	</div>
                           	</div>
                           	<div class="form-group transIn-show-when-makloon-only">
                            	<label class="col-sm-3 control-label">Hasil Barang</label>
                              	<div class="col-sm-9">
                              		<select class="transIn-select-companyProductTo preSerialize-remove chosen-select chosen-transparent form-control">
                              			<option value="">[ Pilih Hasil Barang ]</option>
                              			<option th:each="opt : ${optionsProductBBP}" th:value="${opt.pkCompanyProduct}" th:text="${opt.name}" th:selected="${opt.pkCompanyProduct == bbpItem.companyProductTo?.pkCompanyProduct}"></option>
									</select>
                              	</div>
                           	</div>
                           	<div class="form-group product-section-non-list">
								<label class="col-sm-3 control-label">Jumlah</label>
                              	<div class="col-sm-9 form-input-container">
									<input type="text" class="form-control transIn-product-input-jumlah numeric preSerialize-remove" th:value="${bbpItem.volume}"/>
                              	</div>
                           	</div>
                           	<div class="form-group product-section-non-list">
                              	<label class="col-sm-3 control-label">Satuan</label>
                              	<div class="col-sm-9 form-input-container">
									<select class="chosen-select chosen-transparent form-control transIn-product-select-uom preSerialize-remove" id="input07">
										<option value="">[ Pilih Satuan ]</option>
                                    	<option th:each="opt : ${optionsUOM}" th:value="${opt.pkLookup}" th:text="${opt.nameId}" th:selected="${opt.pkLookup == bbpItem.uom?.pkLookup}"></option>
									</select>
								</div>
                           	</div>
                           	<div class="form-group product-section-non-list transIn-show-when-buy-only">
								<label class="col-sm-3 control-label" for="input01">Harga Beli</label>
								<div class="col-sm-9 form-input-container">
	                                <div class="input-group">
	                                	<span class="input-group-addon addon-greensea">Rp</span>
										<input type="text" class="form-control transIn-product-input-hargaBeli numeric preSerialize-remove" th:value="${bbpItem.fee}"/>
									</div>
                            	</div>
                           	</div>
                           	<div class="form-group product-section-non-list transIn-show-when-buy-only">
								<label class="col-sm-3 control-label" for="input01">Harga Total</label>
                              	<div class="col-sm-9 form-input-container">
                                	<div class="input-group">
                                    	<span class="input-group-addon addon-greensea">Rp</span>
										<input type="text" class="form-control transIn-product-input-hargaTotal numeric preSerialize-remove" readonly="readonly"/>
                                    </div>
                              	</div>
                           	</div>
                           	
                           	<!-- Product List Section -->
                           	<div class="form-group product-section-list" style="display:none">
	                        	<div class="col-sm-12">
	                        	<a href="#" class="btn btn-primary btn-add-product" data-toggle="tooltip" title="Tambah"><i class="fa fa-plus dropdown-plus"></i> &nbsp; Tambah</a>
	                        		<div class="input-group input-group-sm" style="width:100%;">
									<!-- tile -->
	                					<section class="tile color transparent-white">
	                  					<!-- tile body -->
	                  						<div class="tile-body transparent rounded-corners">
	                   							<table class="table table-custom table-sortable transIn-table-product" style="width:100%;">
					 								<thead>
								                        <tr>
								                          <th style="width:29%;">Item</th>
								                          <th style="width:10%;">Jumlah</th>
								                          <th style="width:15%;">Satuan</th>
								                          <th style="width:22%">Harga Beli</th>
								                          <th style="width:22%">Harga Total</th>
								                          <th style="width:5%">&nbsp;</th>
								                        </tr>
								                    </thead>
	                     							<tbody>
	                     								<th:block th:if="*{#lists.isEmpty(items)}">
								                        <tr>
								                        	<td>
								                        		<div class="input-group input-group-sm form-input-container" style="width:100%;">							  
																	<select class="chosen-select chosen-transparent form-control transIn-table-product-bpp-pkCompanyProduct preSerialize-remove">
																		<option value="">[ Pilih Item ]</option>
																		<option th:each="opt : ${optionsProductBPP}" th:value="${opt.pkCompanyProduct}" th:attr="buyingPrice=${opt.buyingPrice},uom=${opt.uom.pkLookup}" th:text="${opt.name}" ></option>
																	</select>
																</div>
															</td>
															<td>
																<div class="form-input-container">
																	<div class="input-group input-group-sm" style="width:100%;">
																		<input type="text" class="form-control transIn-table-product-bpp-volume numeric preSerialize-remove"/>
																	</div>
																</div>
															</td>
															<td>
																<div class="input-group input-group-sm form-input-container" style="width:100%;">							  
																	<select class="chosen-select chosen-transparent form-control transIn-table-product-bpp-uom preSerialize-remove">
																		<option th:each="opt : ${optionsUOM}" th:value="${opt.pkLookup}" th:text="${opt.nameId}"></option>
																	</select>
																</div>
															</td>
															<td>
																<div class="form-input-container">
																	<div class="input-group input-group-sm">
																		<span class="input-group-addon addon-greensea">Rp</span>
																		<input type="text" class="form-control transIn-table-product-bpp-unitFee numeric preSerialize-remove" value="0"/>
																	</div>
																</div>
															</td>
															<td>
																<div class="form-input-container">
																	<div class="input-group input-group-sm">
																		<span class="input-group-addon addon-greensea">Rp</span>
																		<input type="text" class="form-control transIn-table-product-bpp-totalFee numeric preSerialize-remove" value="0"/>
																	</div>																
																</div>
															</td>
            												<td class="text-center"><a href="#" class="btn btn-primary btn-xs transIn-table-product-delete-row" data-toggle="tooltip" title="" data-original-title="Delete"><i class="fa fa-trash"></i></a></td>
								                        </tr>
								                        </th:block>
								                        <th:block th:if="*{not #lists.isEmpty(items)}">
								                        	<tr th:each="item : *{items}">
								                        	<td>
								                        		<div class="input-group input-group-sm form-input-container" style="width:100%;">
																	<input type="hidden" class="transIn-table-product-bpp-pkTransInItem preSerialize-remove" th:value="${item.pkTransInItem}"/>
																	<select class="chosen-select chosen-transparent form-control transIn-table-product-bpp-pkCompanyProduct preSerialize-remove">
																		<option value="">[ Pilih Item ]</option>
																		<option th:each="opt : ${optionsProductBPP}" th:value="${opt.pkCompanyProduct}" th:text="${opt.name}" th:selected="${opt.pkCompanyProduct == item.companyProduct.pkCompanyProduct}"></option>
																	</select>
																</div>
															</td>
															<td>
																<div class="input-group input-group-sm form-input-container" style="width:100%;">
																	<input type="text" class="form-control transIn-table-product-bpp-volume numeric preSerialize-remove" th:value="${item.volume}"/>
																</div>
															</td>
															<td>
																<div class="input-group input-group-sm form-input-container" style="width:100%;">							  
																	<select class="chosen-select chosen-transparent form-control transIn-table-product-bpp-uom preSerialize-remove">
																		<option th:each="opt : ${optionsUOM}" th:value="${opt.pkLookup}" th:text="${opt.nameId}" th:selected="${opt.pkLookup == item.uom.pkLookup}"></option>
																	</select>
																</div>
															</td>
															<td>
																<div class="form-input-container">															
																	<div class="input-group input-group-sm">
																		<span class="input-group-addon addon-greensea">Rp</span>
																		<input type="text" class="form-control transIn-table-product-bpp-unitFee numeric preSerialize-remove" th:value="${item.fee}"/>
																	</div>
																</div>
															</td>
															<td>
																<div class="form-input-container">
																	<div class="input-group input-group-sm">
																		<span class="input-group-addon addon-greensea">Rp</span>
																		<input type="text" class="form-control transIn-table-product-bpp-totalFee numeric preSerialize-remove" th:value="${item.totalFee}"/>
																	</div>
																</div>
															</td>
            												<td class="text-center"><a href="#" class="btn btn-primary btn-xs transIn-table-product-delete-row" data-toggle="tooltip" title="" data-original-title="Delete"><i class="fa fa-trash"></i></a></td>
								                        </tr>
								                        </th:block>
								                    </tbody>
				  								  	<tfoot>
								                        <tr>
								                          <th colspan="6"></th>
								                        </tr>
							                      	</tfoot>
	                   							</table>
					                 		</div>
						                  <!-- /tile body -->
						                  <!-- tile footer -->
						                   <div class="tile-footer bg-transparent-white-2 rounded-bottom-corners">
						                    	<div class="row">  
						                      		<div class="col-sm-4">
						                      	</div>
						                    </div>
							             </div>
					                  <!-- /tile footer -->
					                </section>
					                <!-- /tile --> 
									</div>
	                       		</div>
	                      	</div>
                           	<!-- End Product List Section -->
                           	<div id="productHiddenRow" style="display:none;">
								<table>
								 <tr>
						            <td><div class="input-group input-group-sm form-input-container" style="width:100%;">							  
											<select class="chosen-select chosen-transparent form-control transIn-table-product-bpp-pkCompanyProduct">
												<option value="">[ Pilih Item ]</option>
												<option th:each="opt : ${optionsProductBPP}" th:value="${opt.pkCompanyProduct}" th:attr="buyingPrice=${opt.buyingPrice},uom=${opt.uom.pkLookup}" th:text="${opt.name}" ></option>
											</select></div></td>
									<td><div class="input-group input-group-sm form-input-container" style="width:100%;">
											<input type="text" class="form-control transIn-table-product-bpp-volume numeric preSerialize-remove"/>
										</div>
									</td>
									<td><div class="input-group input-group-sm form-input-container" style="width:100%;">							  
											<select class="chosen-select chosen-transparent form-control transIn-table-product-bpp-uom preSerialize-remove">
												<option th:each="opt : ${optionsUOM}" th:value="${opt.pkLookup}" th:text="${opt.nameId}"></option>
											</select></div></td>
									<td>
										<div class="input-group input-group-sm form-input-container">
											<span class="input-group-addon addon-greensea">Rp</span>
											<input type="text" class="form-control transIn-table-product-bpp-unitFee numeric preSerialize-remove" value="0"/>
										</div>
									</td>
									<td>
										<div class="input-group input-group-sm form-input-container">
											<span class="input-group-addon addon-greensea">Rp</span>
											<input type="text" class="form-control transIn-table-product-bpp-totalFee numeric preSerialize-remove" value="0"/>
										</div>
									</td>		
						            <td class="text-center"><a href="#" class="btn btn-primary btn-xs transIn-table-product-delete-row" data-toggle="tooltip" title="" data-original-title="Delete"><i class="fa fa-trash"></i></a></td>
								 </tr>
								</table>
							</div>
                     	</div>
                     	<!-- END STEP #2 -->
                     	
                     	<!-- STEP #3 -->
                     	<div class="tab-pane" id="step3">
                     		<div class="form-group">
	                     		<div class="col-sm-12">
								<a href="#" class="btn btn-primary masterFee-add" data-toggle="tooltip" title="Tambah"><i class="fa fa-plus dropdown-plus"></i> &nbsp; Tambah</a>
								<section class="tile color transparent-white">
									<div class="tile-body transparent rounded-corners">
		                           		<table class="table table-custom table-sortable masterFee">
			                            	<thead>
												<tr>
			                                    	<th style="width:50%">Item Biaya</th>
			                                    	<th>Harga</th>
			                                    	<th style="width: 30px;">&nbsp;</th>
			                                 	</tr>
			                              	</thead>
			                              	<tbody>
			                              		<th:block th:if="*{pkTransIn==null}" >
				                                	<tr>
				                                    	<td>
				                                       		<div class="input-group" style="width:100%;">
				                                          		<input type='text' class='form-control masterFee-descr'/>
				                                       		</div>
				                                    	</td>
				                                    	<td>
				                                       		<div class="input-group">
				                                          		<span class="input-group-addon addon-greensea">Rp</span>
				                                          		<input type="text" class="form-control masterFee-fee numeric"/>
				                                       		</div>
				                                    	</td>
				                                    	<td class="text-center"><a href="#" class="btn btn-primary btn-xs masterFee-delete-row" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></a></td>
				                                 	</tr>
			                                 	</th:block>
			                                 	<th:block th:if="*{pkTransIn!=null}" >
			                              			<tr th:each="item : *{fees}">
				                                    	<td>
				                                       		<div class="input-group" style="width:100%;">
				                                       			<input type='hidden' class='form-contract masterFee-pkTransInFee' th:value="${item.pkTransInFee}"/>
				                                          		<input type='text' class='form-control masterFee-descr' th:value="${item.descr}"/>
				                                       		</div>
				                                    	</td>
				                                    	<td>
				                                       		<div class="input-group">
				                                          		<span class="input-group-addon addon-greensea">Rp</span>
				                                          		<input type="text" class="form-control masterFee-fee numeric" th:value="${item.fee}"/>
				                                       		</div>
				                                    	</td>
				                                    	<td class="text-center"><a href="#" class="btn btn-primary btn-xs masterFee-delete-row" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></a></td>
				                                 	</tr>
			                              		</th:block>
			                              	</tbody>
			                              	<tfoot>
			                                	<tr>
				                                    <td>Biaya yang dikeluarkan</td>
			            	                    	<td>
			            	                    		<div class="input-group">
			                                          		<span class="input-group-addon addon-greensea">Rp</span>
			                                          		<input type="text" class="form-control masterFee-totalFee numeric" readonly="readonly"/>
			                                       		</div>
			            	                    	</td>
			            	                    	<td></td>
			            	                    </tr>
			                              	</tfoot>
		                           		</table>
	                           		</div>
	                           	</section>
	                     		</div>
	                     		<div class="col-sm-12">
		                     		<div class="form-group product-section-non-list">
		                            	<label class="col-sm-8 control-label" style='text-align:left'>Total biaya yang harus di bayar<br/><em>(Harga Total Pembelian + Biaya yang dikeluarkan)</em></label>
		                              	<div class="col-sm-4">
											<div class="input-group">
	                                      		<span class="input-group-addon addon-greensea">Rp</span>
	                                      		<input type="text" class="form-control total-biaya-bayar numeric" readonly="readonly"/>
	                                   		</div>
		                              	</div>
		                           	</div>
		                           	<div class="form-group product-section-non-list">
		                            	<label class="col-sm-8 control-label" style='text-align:left'>Nilai Stock <br/><em>(Total biaya yang harus di bayar) / Total Stock yang di beli</em></label>
		                              	<div class="col-sm-4">
											<div class="input-group">
	                                      		<span class="input-group-addon addon-greensea">Rp</span>
	                                      		<input type="text" class="form-control input-nilai-stock numeric" readonly="readonly"/>
	                                   		</div>
		                              	</div>
		                           	</div>
		                        </div>
                     		</div>
                     		<div id="masterFeeHiddenRow" style="display:none;">
								<table>
									<tr>
						          		<td>
						             		<div class="input-group form-input-container" style="width:100%;">
						                		<input type='text' class='form-control masterFee-descr'/>
						             		</div>
						          		</td>
						          		<td>
						             		<div class="form-input-container">             		
						             			<div class="input-group">
						                			<span class="input-group-addon addon-greensea">Rp</span>
						                			<input type="text" class="form-control masterFee-fee numeric"/>
						             			</div>
						             		</div>
						          		</td>
						          		<td class="text-center"><a href="#" class="btn btn-primary btn-xs masterFee-delete-row" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></a></td>
						       		</tr>
								</table>
							</div>
                     	</div>
                     	<!-- END STEP #3 -->
                     	
                     	<div class="wizard-actions form-group form-footer" style="background-color : rgba(0, 0, 0, 0.3)">
		                	<div class="col-sm-offset-4 col-sm-8">
		                		<button type="button" id="transIn-detail-btn-cancel" class="btn btn-default">
									<i class="icon-arrow-left"></i>Batal
								</button>
			                	<button type="button" id="transIn-detail-btn-back" class="btn btn-default">
									<i class="icon-arrow-left"></i>Kembali
								</button>
								<button type="button" id="transIn-detail-btn-next" class="btn btn-primary">
									Lanjut
									<i class="icon-arrow-right icon-on-right"></i>
								</button>
								<button type="button" id="transIn-detail-btn-save" class="btn btn-primary">
									Simpan
									<i class="icon-arrow-right icon-on-right"></i>
								</button>
							</div>
						</div>
					</div>
				</form>
			</div>
	</section>
	</div>
</div>
	<script th:inline="javascript">
	/*<![CDATA[*/
	    var buyCode = /*[[${transInTypeBuying}]]*/ #;
	    var maklonCode = /*[[${transInTypeMaklon}]]*/ #;
	    
	    var BBPCode = /*[[${usageItemTypeBBP}]]*/ #;
	    var BPPCode = /*[[${usageItemTypeBPP}]]*/ #;
	    
		function initAdd () {
			$('.transIn-radio-type[value="'+buyCode+'"]').prop('checked', true).trigger('change');
		}
	
		function initEdit () {
			$('.transIn-radio-type-button').removeClass('active');
			$('.transIn-radio-type:checked').closest('.transIn-radio-type-button').addClass('active');
			$('.transIn-radio-item-type-button').removeClass('active');
			$('.transIn-radio-item-type:checked').closest('.transIn-radio-item-type-button').addClass('active');
			$('.transIn-radio-type:checked').trigger('change');
			$('.transIn-radio-item-type:checked').trigger('change');
		}
		
		function calculateBiayaBayarNilaiStock(){
			var total = $('.transIn-product-input-hargaTotal').val();
			var biaya = $('.masterFee-totalFee').val();
			var vol = $('.transIn-product-input-jumlah').val();
			$('.total-biaya-bayar').val((parseFloat(total)+parseFloat(biaya)));
			$('.input-nilai-stock').val((parseFloat(total)+parseFloat(biaya))/parseFloat(vol));
		}

		function countMasterFee () {
			var count = parseInt(0);
			$('.masterFee-fee').each(function(){
				var thisValue = $(this).val();
				if(thisValue != '') {
					var currentRowValue = parseInt($(this).val());
					count += currentRowValue;
				}
			});
			$('.masterFee-totalFee').val(count);
			calculateBiayaBayarNilaiStock();
		}	

		function deleteThisRow (obj) {
			$(obj).closest('tr').remove();
		}
	
		function initMasterFeeEvent () {
			$('.masterFee-delete-row').click(function(e){
				e.preventDefault();
				deleteThisRow(e.target);
				countMasterFee();
			});

			$('.masterFee-fee').change(function(){
				countMasterFee();
			});
		}
		
		function initProductListEvent () {
			$('.transIn-table-product-bpp-pkCompanyProduct').change(function(e){
				var buyingPrice = $(this).closest('tr').find('.transIn-table-product-bpp-pkCompanyProduct :selected').attr('buyingPrice');
				if(buyingPrice) {
					$(this).closest('tr').find('.transIn-table-product-bpp-unitFee').val(buyingPrice);
				} else {
					$(this).closest('tr').find('.transIn-table-product-bpp-unitFee').val(buyingPrice);
				}
				var uom = $(this).closest('tr').find('.transIn-table-product-bpp-pkCompanyProduct :selected').attr('uom');
				if (uom) {
					$(this).closest('tr').find('.transIn-table-product-bpp-uom').val(uom);
				}
			});
			$('.transIn-table-product-bpp-volume').change(function(){
				var thisVolume = $(this).closest('tr').find('.transIn-table-product-bpp-volume').val();
				if(thisVolume) {
					var thisVolumeInt = parseInt(thisVolume);
					var buyingPrice = parseInt($(this).closest('tr').find('.transIn-table-product-bpp-unitFee').val());
					var subTotal = thisVolumeInt * buyingPrice;
					$(this).closest('tr').find('.transIn-table-product-bpp-totalFee').val(subTotal);
				}
			});
		}
		
	    $(function(){
	    	var maintenancePK = $('#transIn-detail-maintenancePk').val();
	    	var editHelper = false;
	    	var editHelper2 = false;

	    	var initWizard = function(id,idbtncancel,idbtnprev,idbtnnext,idbtnfinish){
	    		$('.tab-pane').hide();
	    		var liLength = $('#'+id+' ul.wizard-steps li').length;
	    		
	    		$('#'+id+' ul.wizard-steps li').each(function(){
	    			$(this).css('width',100/parseInt(liLength)+'%').click(function(){
	    				$(this).removeClass('complete').addClass('active').prevAll().switchClass('active','complete');
	    				$(this).nextAll().removeClass('active complete');
	    				$('.wizard-actions button#'+idbtncancel).hide();
	    				$('.wizard-actions button#'+idbtnprev).hide();
	    				$('.wizard-actions button#'+idbtnnext).hide();
	    				$('.wizard-actions button#'+idbtnfinish).hide();
	    				if($(this).is(':first-child')){
	    					$('.wizard-actions button#'+ idbtncancel).show();	
	    				}else{
	    					$('.wizard-actions button#'+ idbtnprev).show();	
	    				}
	    				if($(this).is(':last-child')){
	    					$('.wizard-actions button#'+ idbtnfinish).show();
	    				}else{
	    					$('.wizard-actions button#'+ idbtnnext).show();
	    				}
	    	  			$('.tab-pane').hide();
	    	  			$('#'+$(this).attr('data-target')).show();
	    	  		});
	    	  	});
	    		$('.wizard-actions button#'+idbtncancel).click(function(e){
	    			e.preventDefault();
	    			backToList();
	    		});
	    		$('.wizard-actions button#'+idbtnprev).click(function(e){
	    			e.preventDefault();
	    			$('#'+id+' ul.wizard-steps li.active:not(.complete)').prev().trigger('click');
	    		});
				$('.wizard-actions button#'+idbtnnext).click(function(e){
					e.preventDefault();
					$('#'+id+' ul.wizard-steps li.active:not(.complete)').next().trigger('click');    		
				});
				$('.wizard-actions button#'+idbtnfinish).click(function(e){
					e.preventDefault();
					submitForm();
				});
	    	  	$('#'+id+' ul.wizard-steps').children().eq(0).trigger('click');
	    	};
	    	
	    	initWizard('padiku-wizard','transIn-detail-btn-cancel','transIn-detail-btn-back',
	    			'transIn-detail-btn-next','transIn-detail-btn-save');
	    	
	    	$('.datepicker').datepicker({
	    	    autoclose: true,
	    	    todayHighlight: true,
	    		format: 'dd/mm/yyyy',
	    		onSelect: function(dateText, datePicker) {
	    			$(this).attr('value', dateText);
    		    }
            }).datepicker("setDate", new Date());
	    	
	    	var backToList = function(){
				returnToList('transIn-detail-container', 'transIn-list-container', true);
			};
			
			var preSerialize = function() {
				var indexMasterFee = 0;
				$('.masterFee').find('tbody').find('tr').each(function(){
					$(this).find('.masterFee-pkTransInFee').attr('name', 'fees['+indexMasterFee+'].pkTransInFee');
					$(this).find('.masterFee-descr').attr('name', 'fees['+indexMasterFee+'].descr');
					$(this).find('.masterFee-fee').attr('name', 'fees['+indexMasterFee+'].fee');
					indexMasterFee++;
				});
				
				//serialize product list
				var transType = $('.transIn-radio-type:checked').val();
				var itemType = $('.transIn-radio-item-type:checked').val();
				$('.preSerialize-remove').removeAttr('name');
				if(transType == maklonCode){
					$('.transIn-select-companyProductTo').attr('name', 'items[0].companyProductTo.pkCompanyProduct');
				}
				if (transType == buyCode && itemType == BBPCode){
					$('.transIn-product-input-hargaBeli').attr('name', 'items[0].fee');
					$('.transIn-product-input-hargaTotal').attr('name', 'items[0].totalFee');
				}		
				if ((transType == buyCode && itemType == BBPCode) || transType == maklonCode) {
					$('.transIn-hidden-transInItem-maintenancePK').attr('name', 'items[0].pkTransInItem');
					$('.transIn-select-companyProduct').attr('name', 'items[0].companyProduct.pkCompanyProduct');
					$('.transIn-product-input-jumlah').attr('name', 'items[0].volume');
					$('.transIn-product-select-uom').attr('name', 'items[0].uom.pkLookup');
				} else if (transType == buyCode && itemType == BPPCode) {
					var productIndex = 0;
					$('.transIn-table-product').find('tbody').find('tr').each(function(){						
						$(this).find('.transIn-table-product-bpp-pkCompanyProduct').attr('name', 'items['+productIndex+'].companyProduct.pkCompanyProduct');
						$(this).find('.transIn-table-product-bpp-volume').attr('name', 'items['+productIndex+'].volume');
						$(this).find('.transIn-table-product-bpp-uom').attr('name', 'items['+productIndex+'].uom.pkLookup');
						$(this).find('.transIn-table-product-bpp-unitFee').attr('name', 'items['+productIndex+'].fee');
						$(this).find('.transIn-table-product-bpp-totalFee').attr('name', 'items['+productIndex+'].totalFee');
						productIndex++;
					});
				}
			}
	    	
			var submitForm = function(){
				cleanErrorParsley(3);
				var sURL = /*[[@{/do/penerimaan/saveTransIn/}]]*/ #;
				preSerialize();
				$.post(sURL, $("#transIn-detail-form").serialize(), function(data) {
					if(data.errorList!=null){
						displayErrorParsley(data.errorList, 3);
					}else{
						backToList();
					}
				});
			};
			
			var showProductListSection = function(isTrue) {
				if (isTrue) {
					$('.product-section-non-list').hide();
					$('.product-section-list').show();
				} else {
					$('.product-section-non-list').show();
					$('.product-section-list').hide();
				}
			}
			
			var transInItemTypeChange = function(type, transInType) {
				if ( type == BPPCode && transInType == buyCode){
					showProductListSection(true);
				}else{
					showProductListSection(false);
				}
				if(maintenancePK && !editHelper2) {
					editHelper2 = true;	
				} else {
					populateDefaultFee();
				}
			}
			
			var convertFeesToHtml = function (data) {
				var html = "";
				if(data){
					for(var i=0;i<data.length;i++){
						html += "<tr>";
						html += "<td>";
	                   	html += "<div class='input-group' style='width:100%;'>";
	                   	html += "<input type='text' class='form-control masterFee-descr' value='"+data[i].descr+"'/>";
	                   	html += "</div>";
	                	html += "</td>";
	                	html += "<td>";
	                   	html += "<div class='input-group'>";
	                    html += "<span class='input-group-addon addon-greensea'>Rp</span>";
	                    html += "<input type='hidden' class='form-control masterFee-unit-fee numeric' value='"+data[i].unitFee+"'/>";
	                    html += "<input type='hidden' class='form-control masterFee-unit-uom numeric' value='"+data[i].uom.pkLookup+"'/>";
	                    html += "<input type='text' class='form-control masterFee-fee numeric' value='"+data[i].unitFee+"'/>";
	                   	html += "</div>";
	                	html += "</td>";
	                	html += "<td class='text-center'><a href='#' class='btn btn-primary btn-xs masterFee-delete-row' data-toggle='tooltip' title='Delete'><i class='fa fa-trash'></i></a></td>";
						html += "</tr>";
					}	
				}
				return html;
			}
			
			var populateDefaultFee = function() {
				var itemType = $('.transIn-radio-item-type:checked').val();
				var bbFees = /*[[${feeBBPList}]]*/ #;
				var bpFees = /*[[${feeBPPList}]]*/ #;
				if (itemType == BBPCode) {
					$('.masterFee').find('tbody').html('');
					var html = convertFeesToHtml(bbFees);
					$('.masterFee').find('tbody').html(html);
				} else if (itemType = BPPCode ) {
					$('.masterFee').find('tbody').html('');
					var html = convertFeesToHtml(bpFees);
					$('.masterFee').find('tbody').html(html);
				}
				initMasterFeeEvent();
				$('.masterFee-fee').trigger('change');
			}
			
			var transInTypeChange = function(type) {
				if(type==undefined){
					type = buyCode;
				}
				$('.transIn-show-when-makloon-only').hide();
				if (type == maklonCode) {
					$('.transIn-show-when-makloon-only').show();
					$('.transIn-radio-item-type[value="'+BBPCode+'"]').prop('checked', true).trigger('change');
					$('.transIn-show-when-buy-only').hide();
				} else {
					$('.transIn-show-when-buy-only').show();
					if (maintenancePK && !editHelper) {
						editHelper = true;
					} else {
						$('.transIn-radio-item-type[value="'+BBPCode+'"]').prop('checked', true).trigger('change');
					}
					if (!maintenancePK) {
						populateDefaultFee();
					}
				}
			}
			
			var addRowProduct = function (obj) {
				var html = "<tr>" + $('#productHiddenRow').find('tr').html() + "</tr>";
				$('.transIn-table-product').find('tbody').append(html);
				$('.transIn-table-product-delete-row').click(function(e){
					e.preventDefault();
					deleteThisRow(e.target);
				});
				initNumeric();
				initProductListEvent();
			}
			
			var addRowMasterFee = function () {
				var html = "<tr>" + $('#masterFeeHiddenRow').find('tr').html() + "</tr>";
				$('.masterFee').find('tbody').append(html);
				initMasterFeeEvent();
				initNumeric();
			}
			
			var populateTransInItems = function () {
				var transTypeCode = $('.transIn-radio-type:checked').val();
				var itemTypeCode = $('.transIn-radio-item-type:checked').attr('code');
				var items = /*[[${detail.items}]]*/ #;
				if((transTypeCode == buyCode && itemTypeCode == BBPCode) || transTypeCode == maklonCode) {
					if(items) {
						for(var i=0;i<items.length;i++) {
							$('.transIn-hidden-transInItem-maintenancePK').val(items[i].pkTransInItem);
							$('.transIn-select-companyProduct').val(items[i].companyProduct.pkCompanyProduct);
							$('.transIn-product-input-jumlah').val(items[i].volume);
							$('.transIn-product-select-uom').val(items[i].uom.pkLookup);
							$('.transIn-product-input-hargaBeli').val(items[i].fee);
							$('.transIn-product-input-hargaTotal').val(items[i].totalFee);
						}
					}
				} else {
					//handle with thymeleaf
				}
			}
			
			$('.transIn-radio-type').change(function(e){
				var type = $('.transIn-radio-type:checked').val();
				transInTypeChange(type);
			});
			
			var type = $('.transIn-radio-type:checked').val();
			transInTypeChange(type);
			
			$('.transIn-radio-item-type').change(function(e){
				var type = $('.transIn-radio-item-type:checked').val();
				var transInType = $('.transIn-radio-type:checked').val();
				transInItemTypeChange(type, transInType);
			});
			
			
			$('.btn-add-product').click(function(e){
				addRowProduct();
			});
			
			$('.transIn-table-product-delete-row').click(function(e){
				e.preventDefault();
				deleteThisRow(e.target);
			});
			
			$('.masterFee-add').click(function(e){
				addRowMasterFee();
			});
			
			$('.transIn-select-companyProduct').change(function(){
				var buyingPrice = $('.transIn-select-companyProduct :selected').attr('buyingPrice');
				var uom = $('.transIn-select-companyProduct :selected').attr('uom');
				$('.transIn-product-select-uom').val(uom);
				$('.transIn-product-input-hargaBeli').val(buyingPrice);
			});
			
			var calculateTotalFee = function () {
				var jumlah = $('.transIn-product-input-jumlah').val();
				var hargaBeli = $('.transIn-product-input-hargaBeli').val();
				if ( jumlah && hargaBeli) {
					var jumlahInt = parseInt(jumlah);
					var hargaBeliInt = parseInt(hargaBeli);
					var total = jumlahInt * hargaBeli;
					$('.transIn-product-input-hargaTotal').val(jumlahInt * hargaBeli);
				} else {					
					$('.transIn-product-input-hargaTotal').val(0);
				}
				calculateBiayaBayarNilaiStock();
			}
			
			var calculateItemFee = function(jumlah){
				$('.masterFee .masterFee-unit-fee').each(function(){
					var objTr = $(this).closest('tr');
					var uom = objTr.find('.masterFee-unit-uom').val();
					if($('.transIn-product-select-uom').val() == uom){
						objTr.find('.masterFee-fee').val(parseFloat($(this).val()) * parseFloat($('.transIn-product-input-jumlah').val()));
					}
				});
				countMasterFee();
			};
			
			$('.transIn-product-input-jumlah').change(function(){
				calculateTotalFee();
				calculateItemFee($(this).val());
				calculateBiayaBayarNilaiStock();
			});
			
			$('.transIn-product-input-hargaBeli').change(function(){
				calculateTotalFee();
				calculateBiayaBayarNilaiStock();
			});
			
			$('.masterFee-fee').change(function(){
				countMasterFee();
			});
			
	    	if (!maintenancePK) {
	    		initAdd();
	    	} else {
	    		$('.masterFee-fee').trigger('change');
	    		initEdit();
	    		populateTransInItems();
	    	}
	    	initMasterFeeEvent();
	    	initNumeric();
	    	initProductListEvent();
	    	calculateTotalFee();
	    });
	/*]]>*/
	</script>
</body>
</html>